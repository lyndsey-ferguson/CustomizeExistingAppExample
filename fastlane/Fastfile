
platform :ios do
  lane :customize_build do |options|
    welcome_message = options[:welcome_message] || 'Hello World!'
    background_color = options[:background_color] || '#FFFFFFFF'

    update_plist(
      plist_path: './AppExample/AppExample/configurations.plist',
      block: proc do |plist|
        plist[:WelcomeMessage] = welcome_message
        plist[:BackgroundHexColor] = background_color
      end
    )
  end

  lane :build_custom_app do |options|
    customize_build options
    keychain_data = get_keychain_from_vault(vault_addr: 'http://127.0.0.1:8200', keychain_name: 'lyndsey')
    unlock_keychain(path: keychain_data[:keychain_path], password: keychain_data[:keychain_password])
    build_app(
        scheme: 'AppExample',
        project: './AppExample/AppExample.xcodeproj',
        export_options: {
          method: "app-store",
          provisioningProfiles: {
            "com.yilly.yally" => "Yillyyally"
          }
        }
    )
  end
end

